"""ChatGPTç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«"""

from ..models.hooks import HookItem
from ..models.transcription import TranscriptionResult, TranscriptionSegment


class PromptBuilder:
    """ChatGPTç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã‚¯ãƒ©ã‚¹ï¼ˆ2æ®µéšå¯¾å¿œç‰ˆï¼‰

    æ–‡å­—èµ·ã“ã—çµæœã‹ã‚‰ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ä¼ç”»æ›¸ç”Ÿæˆç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚
    2æ®µéšå‡¦ç†ï¼ˆãƒ•ãƒƒã‚¯æŠ½å‡ºâ†’è©³ç´°å°æœ¬ä½œæˆï¼‰ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

    Example:
        >>> from src.models.transcription import TranscriptionResult, TranscriptionSegment
        >>> segments = [TranscriptionSegment(0.0, 10.0, "ãƒ†ã‚¹ãƒˆå†…å®¹")]
        >>> transcription = TranscriptionResult(segments, "ãƒ†ã‚¹ãƒˆå†…å®¹")
        >>> builder = PromptBuilder()
        >>> hooks_prompt = builder.build_hooks_prompt(transcription)
        >>> print(len(hooks_prompt) > 0)
        True

    """

    # ãƒ•ãƒƒã‚¯æŠ½å‡ºç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    HOOKS_PROMPT_TEMPLATE = """# ä¾é ¼å†…å®¹
ä»¥ä¸‹ã®å‹•ç”»ã®æ›¸ãèµ·ã“ã—ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ã€åˆ‡ã‚ŠæŠœãå‹•ç”»ã¨ã—ã¦é©åˆ‡ãªãƒ•ãƒƒã‚¯ã¨ãªã‚‹è¦ç´ ã‚’å°å‡ºã—ã¦ãã ã•ã„ã€‚

# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ï¼šZä¸–ä»£ï¼ˆ10ã€œ20ä»£ï¼‰

# å‰æ
- å‹•ç”»ã®ä¸­ã§è©±ã—ã¦ã„ã‚‹å†…å®¹ã«åˆ‡ã‚ŠæŠœãç®‡æ‰€ã¯ã€ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã«å½“ã¦ã¯ã¾ã‚‹ã“ã¨ãŒæœ›ã¾ã—ã„ï¼š
- ç™»å ´äººç‰©ã®æ„Ÿæƒ…ï¼ˆé©šãã€æ€’ã‚Šã€ç¬‘ã„ã€æ„Ÿå‹•ãªã©ï¼‰ãŒå¼·ãå‡ºã¦ã„ã‚‹å ´é¢
- ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ€§ãƒ»å¤‰åŒ–ãƒ»çµè«–ãƒ»ä¸»å¼µãŒæ˜å¿«ãªå ´é¢
- ç‰¹å®šã®ä¾¡å€¤è¦³ãƒ»ä¿¡å¿µãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä¸€è¨€ã§è¡¨ç¾ã§ãã‚‹å ´é¢
- åˆ‡ã‚ŠæŠœãå‹•ç”»ã«å‘ã„ã¦ã„ã‚‹ç®‡æ‰€ã‚’ **5 å€‹**ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚
- å„ã‚¯ãƒªãƒƒãƒ—ã®é•·ã•ã¯ **ç´„ 1 åˆ†**ã‚’ç›®å®‰ã«ã—ã¦ãã ã•ã„ã€‚
- ã“ã®å‹•ç”»ã‹ã‚‰åˆ‡ã‚ŠæŠœãå‹•ç”»ã‚’ä½œã£ã¦ **é¢ç™½ã„**ä½œå“ã«ã—ãŸã„ã§ã™ã€‚
- çµµæ–‡å­—ã¯å¤šãä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
- ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ãƒã‚ºã®ã‚³ãƒ„ã¯ã€è¦–è´è€…ã‚’å†’é ­ã§æƒ¹ãã¤ã‘ã‚‹å¼·çƒˆãªãƒ•ãƒƒã‚¯ã§ã™ã€ãƒ•ãƒƒã‚¯ã‚’æ„è­˜ã—ã¦ãã ã•ã„ã€‚

# ãƒ•ãƒƒã‚¯ã‚’ä½œã‚‹ãŸã‚ã® TIPS
- 1.é©šãã§æƒ¹ãã¤ã‘ã‚‹ï¼ˆSurpriseï¼‰
- ä¾‹ï¼šã€Œãˆã€ã“ã‚“ãªæ”¿æ²»å®¶è¦‹ãŸã“ã¨ãªã„ï¼ã€
- ç†ç”±ï¼šäºˆæƒ³å¤–ã®å±•é–‹ãƒ»äººç‰©åƒã‚’äºˆæ„Ÿã•ã›ã‚‹ã“ã¨ã§ã€ç¶šãã‚’è¦‹ãŸããªã‚‹ã€‚

- 2.å•ã„ã‹ã‘ã§å‚åŠ ã•ã›ã‚‹ï¼ˆQuestionï¼‰
- ä¾‹ï¼šã€Œã‚ãªãŸã¯ã“ã®äº‹å®Ÿã€çŸ¥ã£ã¦ã¾ã—ãŸã‹ï¼Ÿã€
- ç†ç”±ï¼šè¦–è´è€…ã«å†…å¿ƒã§"ç­”ãˆã•ã›ã‚‹"ã“ã¨ã§å½“äº‹è€…æ„è­˜ã‚’ç”Ÿã¿å‡ºã™ã€‚

- 3.æ¥µç«¯ãªè¨€ã„åˆ‡ã‚Šã§ç›®ã‚’å¼•ãï¼ˆBold Claimï¼‰
- ä¾‹ï¼šã€Œæ”¿æ²»ã£ã¦ã€ã»ã¼å®—æ•™ã§ã™ã€‚ã€
- ç†ç”±ï¼šåˆºæ¿€çš„ãªä¸»å¼µãŒã€Œæœ¬å½“ã«ï¼Ÿã€ã¨ã„ã†å¥½å¥‡å¿ƒã‚’å¼•ãå‡ºã™ã€‚

- 4.ã‚®ãƒ£ãƒƒãƒ—ã‚„çŸ›ç›¾ã‚’æç¤ºã™ã‚‹ï¼ˆContradiction / Tensionï¼‰
- ä¾‹ï¼šã€ŒAIæ¨é€²æ´¾ã®å½¼ãŒã€å®Ÿã¯"åå¯¾æ´¾"ã ã£ãŸç†ç”±ã¨ã¯ã€
- ç†ç”±ï¼šã€Œä¸€è¦‹æ­£åå¯¾ã€ã«è¦‹ãˆã‚‹äº‹å®Ÿã‚’ä¸¦ã¹ã‚‹ã“ã¨ã§ã€ç¶šããŒæ°—ã«ãªã‚‹æ§‹é€ ã«ãªã‚‹ã€‚

- 5.æ„Ÿæƒ…ãƒ¯ãƒ¼ãƒ‰ã‚’å…ˆå‡ºã—ã™ã‚‹ï¼ˆEmotion Firstï¼‰
- ä¾‹ï¼šã€Œæ€’ã‚Šã‚’è¦šãˆãŸå‡ºæ¥äº‹ã€
- ç†ç”±ï¼šæ„Ÿæƒ…ã‚’å…ˆã«å‡ºã™ã¨ã€å…±æ„Ÿã‚„èˆˆå‘³ãŒèµ·ç‚¹ã«ãªã‚Šã‚„ã™ã„ã€‚

- 6.ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³/ãƒªã‚¹ãƒˆæ§‹é€ ã§è¦–èªæ€§UPï¼ˆNumbered Listï¼‰
- ä¾‹ï¼šã€Œæ”¿æ²»å®¶ã®ãƒ¤ãƒã„ç™ºè¨€ãƒˆãƒƒãƒ—3ã€
- ç†ç”±ï¼šæ•°å­—ãŒå…¥ã‚‹ã¨ã€Œä½•ãŒ1ä½ãªã®ã‹ï¼Ÿã€ã¨æœ€å¾Œã¾ã§è¦‹ãŸããªã‚‹ã€‚

- 7.ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«è¦–è¦šçš„ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã‚’å…¥ã‚Œã‚‹ï¼ˆVisual Wordï¼‰
- ä¾‹ï¼šã€Œå¹´å300ä¸‡å††ã§"è­°å“¡"ã£ã¦ã©ã†ã„ã†ã“ã¨ï¼Ÿã€
- ç†ç”±ï¼šã€Œæ•°å­—ã€ã‚„ã€Œè‚©æ›¸ãã€ãªã©ã‚’å†’é ­ã«å…¥ã‚Œã‚‹ã¨æ³¨ç›®ãŒé›†ã¾ã‚Šã‚„ã™ã„ã€‚

- 8.ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç‰¹å®šå‹ï¼ˆIf you're __ï¼‰
- ä¾‹ï¼šã€Œ20ä»£ã§æ”¿æ²»ã«èˆˆå‘³ãªã„äººã€ã¡ã‚‡ã£ã¨æ¥ã¦ã€
- ç†ç”±ï¼šã€Œã“ã‚Œã¯è‡ªåˆ†å‘ã‘ã®å‹•ç”»ã ã€ã¨æ„Ÿã˜ã•ã›ã‚‹ã¨é›¢è„±ç‡ãŒæ¸›ã‚‹ã€‚

- 9.ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ï¼ä»Šã ã‘è¦ç´ ï¼ˆUrgencyï¼‰
- ä¾‹ï¼šã€Œã“ã®åˆ¶åº¦ã€æ¥æœˆã‹ã‚‰å¤‰ã‚ã‚Šã¾ã™ã€
- ç†ç”±ï¼šã™ãã«çŸ¥ã£ã¦ãŠã‹ãªã„ã¨æã™ã‚‹æ„Ÿè¦šã‚’æ¤ãˆä»˜ã‘ã‚‹ã€‚

- 10.ã‚·ãƒ¼ãƒ³èª¬æ˜ï¼‹è¬ã‹ã‘ï¼ˆNarrative Hookï¼‰
- ä¾‹ï¼šã€Œå±…é…’å±‹ã§çªç„¶"ã‚ã®è©±"ãŒå§‹ã¾ã£ãŸã€
- ç†ç”±ï¼šã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ€§ã®å…¥ã‚Šå£ã¨"ä½•ã®è©±ï¼Ÿ"ã¨ã„ã†è¬ã‚’åŒæ™‚ã«

# å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
{{
  "items": [
    {{
      "first_hook": "",
      "second_hook": "",
      "third_hook": "",
      "last_conclusion": "",
      "summary": ""
    }},
    ...
  ]
}}"""

    # è©³ç´°å°æœ¬ä½œæˆç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    SCRIPT_PROMPT_TEMPLATE = """# ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»å°æœ¬ä½œæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‹æœ¬äººç™ºè¨€æ··åˆæ§‹æˆï¼‰

ã‚ãªãŸã¯å‹•ç”»ç·¨é›†è€…ã®ãŸã‚ã«ã€Zä¸–ä»£å‘ã‘ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ã®å°æœ¬ã‚’æ§‹æˆã™ã‚‹ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã§ã™ã€‚
ä»¥ä¸‹ã® `item` æƒ…å ±ã¨ `segments`ï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãæ–‡å­—èµ·ã“ã—ï¼‰ã‚’ã‚‚ã¨ã«ã€**1åˆ†ä»¥å†…ã®å‹•ç”»æ§‹æˆæ¡ˆ**ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

---

## å…¥åŠ›

- `item`: {{ITEM_PLACEHOLDER}}

- `segments`: {{SEGMENTS_PLACEHOLDER}}

---

## å‡ºåŠ›æ¡ä»¶

1. å°æœ¬å…¨ä½“ã¯**60ç§’ä»¥å†…**ã«ã—ã¦ãã ã•ã„ã€‚
2. **first_hook**ã¯ã€å†’é ­ã«ãƒ†ãƒ­ãƒƒãƒ—ï¼‹ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
3. **segmentsã®ä¸­ã‹ã‚‰ç™ºè¨€ã‚’2ã€œ3å€‹æŠ½å‡º**ã—ã€æœ¬äººç™ºè¨€ãƒ‘ãƒ¼ãƒˆã¨ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
4. ãã®ä»–ã®éƒ¨åˆ†ã¯ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§è£œå®Œã—ã¦ãã ã•ã„ã€‚
5. ã‚»ãƒªãƒ•ã¯æ•´ãˆã‚‹ç¨‹åº¦ã®ç·¨é›†ï¼ˆå£èªãƒ»ã¤ãªãï¼‰ã‚’OKã¨ã—ã¤ã¤ã€**æœ¬äººã‚‰ã—ã•ã¯æ®‹ã—ã¦ãã ã•ã„**ã€‚
6. å„ç™ºè¨€ãƒ»ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ãƒ¼ãƒˆã®ç§’æ•°ã‚’ç›®å®‰ã¨ã—ã¦è¨˜è¼‰ã—ã¦ãã ã•ã„ï¼ˆç·¨é›†ã®å‚è€ƒã«ï¼‰ã€‚
7. æœ€å¾Œã« `last_conclusion` ã‚’å«ã‚ãŸ**ç· ã‚ã®ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¾ãŸã¯ã‚»ãƒªãƒ•**ã‚’å«ã‚ã¦ãã ã•ã„ã€‚

---

## å‡ºåŠ›å½¢å¼

ã€å°æœ¬æ§‹æˆã€‘
[00:00â€“00:06] ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‹ãƒ†ãƒ­ãƒƒãƒ—
ğŸ§ ãˆã€å°å­¦ç”Ÿã§Excelã§ã‚²ãƒ¼ãƒ ä½œã£ã¦ãŸï¼ï¼Ÿ

[00:06â€“00:18] æœ¬äººç™ºè¨€
ã€Œå°å­¦ç”Ÿã®ã¨ãã€Excelã®ãƒã‚¯ãƒ­ã§å›½å®¶é–“ã®æˆ¦äº‰ã‚²ãƒ¼ãƒ ä½œã£ã¦ã¾ã—ãŸã€

[00:18â€“00:26] ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
ã¾ã•ã‹ã®ãƒã‚¯ãƒ­ã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ ã€‚
ã—ã‹ã‚‚ã‚¸ãƒ£ãƒ³ãƒ«ã¯â€¦æˆ¦äº‰ï¼ï¼Ÿå¤©æ‰ã™ãã‚‹ï¼

[00:26â€“00:36] æœ¬äººç™ºè¨€
ã€Œè¡¨ã«å…µåŠ›å…¥ã‚Œã¦ã€å‹æ‰‹ã«æˆ¦æ³ãŒå¤‰ã‚ã‚‹ã‚ˆã†ã«ã—ã¦ã¾ã—ãŸã€

[00:36â€“00:54] ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
å‘¨ã‚Šã®å‹é”ã¯ã‚‚ã¡ã‚ã‚“ã€Œãƒã‚¯ãƒ­ã£ã¦ä½•ï¼Ÿã€çŠ¶æ…‹ã€‚
Excelï¼è¡¨è¨ˆç®—ã£ã¦æ€ã£ã¦ã‚‹ã¨ã€ä¸–ç•Œç‹­ã„ã‚ˆâ€¦ï¼

[00:54â€“01:00] ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç· ã‚ï¼‰
Zä¸–ä»£ã‚ˆã€Excelã¯ãŸã ã®è¡¨è¨ˆç®—ã˜ã‚ƒãªã„âœŠâœ¨"""

    def __init__(self) -> None:
        """ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åˆæœŸåŒ–"""

    def build_hooks_prompt(self, transcription: TranscriptionResult) -> str:
        """ãƒ•ãƒƒã‚¯æŠ½å‡ºç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰

        Args:
            transcription: æ–‡å­—èµ·ã“ã—çµæœ

        Returns:
            ãƒ•ãƒƒã‚¯æŠ½å‡ºç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

        """
        self._validate_transcription(transcription)

        # ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæƒ…å ±ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        segments_text = self._format_segments(transcription.segments)

        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æ–‡å­—èµ·ã“ã—æƒ…å ±ã‚’åŸ‹ã‚è¾¼ã¿
        prompt = (
            self.HOOKS_PROMPT_TEMPLATE
            + f"""

# å‹•ç”»æ›¸ãèµ·ã“ã—

## å…¨ä½“ãƒ†ã‚­ã‚¹ãƒˆ
{transcription.full_text}

## ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãã‚»ã‚°ãƒ¡ãƒ³ãƒˆ
{segments_text}
"""
        )

        return prompt

    def build_script_prompt(self, hook_item: HookItem, segments: list[TranscriptionSegment]) -> str:
        """è©³ç´°å°æœ¬ä½œæˆç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰

        Args:
            hook_item: ãƒ•ãƒƒã‚¯æƒ…å ±
            segments: æ–‡å­—èµ·ã“ã—ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ

        Returns:
            è©³ç´°å°æœ¬ä½œæˆç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

        Note:
            SCRIPT_PROMPT_TEMPLATEã®`{{ITEM_PLACEHOLDER}}`ã¨`{{SEGMENTS_PLACEHOLDER}}`ã‚’
            å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã§ç½®æ›ã™ã‚‹

        """
        # ãƒ•ãƒƒã‚¯æƒ…å ±ã‚’JSONå½¢å¼ã§æ•´å½¢
        item_json = f"""{{
    "first_hook": "{self._escape_json_string(hook_item.first_hook)}",
    "second_hook": "{self._escape_json_string(hook_item.second_hook)}",
    "third_hook": "{self._escape_json_string(hook_item.third_hook)}",
    "last_conclusion": "{self._escape_json_string(hook_item.last_conclusion)}",
    "summary": "{self._escape_json_string(hook_item.summary)}"
}}"""

        # ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæƒ…å ±ã‚’JSONå½¢å¼ã§æ•´å½¢
        segments_json = "[\n"
        for segment in segments:
            # JSONã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
            escaped_text = self._escape_json_string(segment.text)
            segments_json += f"""    {{
        "start_time": {segment.start_time},
        "end_time": {segment.end_time},
        "text": "{escaped_text}"
    }},\n"""
        segments_json = segments_json.rstrip(",\n") + "\n]"

        # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’ç½®æ›
        prompt = self.SCRIPT_PROMPT_TEMPLATE

        # ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’ç½®æ›
        prompt = prompt.replace("{{ITEM_PLACEHOLDER}}", item_json)
        prompt = prompt.replace("{{SEGMENTS_PLACEHOLDER}}", segments_json)

        return prompt

    def _escape_json_string(self, text: str) -> str:
        """JSONæ–‡å­—åˆ—ç”¨ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†

        Args:
            text: ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹æ–‡å­—åˆ—

        Returns:
            ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚ŒãŸæ–‡å­—åˆ—

        """
        return text.replace('"', '\\"').replace("\n", "\\n").replace("\r", "\\r").replace("\t", "\\t")

    def _format_time_to_hms(self, seconds: float) -> str:
        """ç§’æ•°ã‚’hh:mm:sså½¢å¼ã«å¤‰æ›

        Args:
            seconds: å¤‰æ›ã™ã‚‹ç§’æ•°

        Returns:
            hh:mm:sså½¢å¼ã®æ™‚åˆ»æ–‡å­—åˆ—

        """
        hours = int(seconds // 3600)
        minutes = int((seconds % 3600) // 60)
        secs = int(seconds % 60)
        return f"{hours:02d}:{minutes:02d}:{secs:02d}"

    def _format_segments(self, segments: list[TranscriptionSegment]) -> str:
        """ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæƒ…å ±ã‚’èª­ã¿ã‚„ã™ã„å½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

        Args:
            segments: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ãƒªã‚¹ãƒˆ

        Returns:
            ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ–‡å­—åˆ—

        """
        formatted_lines = []
        for i, segment in enumerate(segments, 1):
            start_time = self._format_time_to_hms(segment.start_time)
            end_time = self._format_time_to_hms(segment.end_time)

            time_range = f"[{start_time} - {end_time}]"
            formatted_lines.append(f"{i:3d}. {time_range} {segment.text}")

        return "\n".join(formatted_lines)

    def _validate_transcription(self, transcription: TranscriptionResult) -> None:
        """æ–‡å­—èµ·ã“ã—çµæœã®å¦¥å½“æ€§ã‚’ãƒã‚§ãƒƒã‚¯

        Args:
            transcription: æ¤œè¨¼ã™ã‚‹æ–‡å­—èµ·ã“ã—çµæœ

        Raises:
            ValueError: transcriptionãŒç„¡åŠ¹ãªå ´åˆ

        """
        if not transcription.segments:
            raise ValueError("ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒç©ºã§ã™")
        if not transcription.full_text.strip():
            raise ValueError("å…¨ä½“ãƒ†ã‚­ã‚¹ãƒˆãŒç©ºã§ã™")
